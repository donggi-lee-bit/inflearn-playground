# 재고시스템으로 알아보는 동시성이슈 해결방법

## 재고 감소 로직의 문제점

요청이 동시에 여러 개가 들어온다면?
- `race condition` 발생
  - 둘 이상의 스레드가 공유 데이터에 액세스하여 동시에 변경하려고 할 때 발생하는 문제
- 하나의 스레드만 데이터에 액세스 할 수 있도록 해야한다 

## syncronized 키워드 사용 시 문제점

- java 의 `syncronized`는 하나의 프로세스 안에서만 동시성을 보장
- 서버가 1대일 때는 문제 없지만 서버가 2대 이상일 때에는 여러 개의 서버를 통해 데이터에 접근하게 됨
- 결국 다시 `race condition` 이 발생
- 실제 운영 환경에서는 서버를 1대만 사용하지 않기에 `syncronized` 키워드로 동시성을 해결하기에는 문제가 있다. 

## Database 를 활용하여 데이터 정합성을 맞추는 방법

<b>Pessimistic Lock(exclusive lock)</b>
비관적 락

- 다른 트랜잭션이 특정 행의 lock 을 얻는 것을 방지
  - A 트랜잭션이 끝날 때까지 기다렸다가 B 트랜잭션이 lock 을 획득
  - 특정 행을 업데이트 하거나 삭제할 수 있음
  - 일반적인 조회는 별다른 lock 없이 수행 가능

<b>Optimistic Lock</b> 낙관적 락


- lock 을 걸지 않고 문제가 발생할 때 처리
  - 대표적으로 version column 을 만들어 해결할 수 있음

<b>Named Lock</b>
- 이름과 함께 lock 획득. 해당 lock 은 다른 세션에서 획득 및 해제가 불가능하도록 동작.
